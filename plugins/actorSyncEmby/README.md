# 演员同步 Emby 插件 (Actor Sync Emby)

一个 Stash 插件，用于将演员信息（图片和元数据）从 Stash 同步到 Emby 服务器。

## 功能特性

- **演员图片同步** - 从 Stash 下载演员头像并上传到 Emby
- **元数据导出** - 生成包含详细信息的 NFO 文件到本地目录
- **Emby 集成** - 通过 API 直接更新 Emby 中的演员元数据
- **多种同步模式** - 支持覆盖、元数据更新和增量补齐三种模式
- **自动化钩子** - 支持在演员信息更新时自动同步
- **批量处理** - 支持一次性同步所有演员
- **模拟运行** - 提供 dry-run 模式预览操作

## 安装

1. 将 `actorSyncEmby` 文件夹复制到 Stash 的插件目录
2. 重启 Stash 服务
3. 在 设置 → 插件 中启用该插件

## 配置选项

| 配置项 | 类型 | 描述 |
|--------|------|------|
| `演员数据输出目录` | 字符串 | 本地存储演员图片和 NFO 文件的目录路径 |
| `Task：本地导出模式` | 数字 | 0=不导出，1=覆盖 (图片+NFO)，2=只 NFO，3=只图片，4=补缺 |
| `Task：Emby 上传模式` | 数字 | 0=不上传，1=覆盖 (图片 + 元数据)，2=只元数据，3=只图片，4=补缺 |
| `Hook 响应模式` | 数字 | 0=关闭，1=只本地 (覆盖)，2=只 Emby(覆盖)，3=同时 (覆盖) |
| `Emby 服务器地址` | 字符串 | Emby 服务器完整 URL（如 http://192.168.1.100:8096） |
| `Emby API 密钥` | 字符串 | Emby 服务器 API 密钥 |
| `仅模拟` | 布尔值 | 模拟运行模式，不执行实际文件操作 |
| `启用异步日志` | 布尔值 | 是否将新建演员异步同步日志写入文件 |

## 同步模式说明

### Task：本地导出模式

**模式 0：不导出**
- 跳过本地文件导出

**模式 1：覆盖 (图片+NFO)**
- 无论本地是否已存在，都会重新生成 NFO 和下载图片
- 适用于需要完全同步的场景

**模式 2：只 NFO**
- 仅生成 NFO 元数据文件
- 不处理演员图片

**模式 3：只图片**
- 仅下载演员图片
- 不生成 NFO 文件

**模式 4：增量补缺**
- 检查本地已有的文件，只导出缺失的部分
- 避免重复导出，提高效率

### Task：Emby 上传模式

**模式 0：不上传**
- 跳过 Emby 上传

**模式 1：覆盖 (图片 + 元数据)**
- 无论 Emby 中是否已存在，都会重新上传图片和更新元数据
- 适用于需要完全同步的场景

**模式 2：只元数据**
- 仅更新演员文本信息（概述、生日、标签等）
- 不处理演员图片

**模式 3：只图片**
- 仅上传演员头像
- 不更新元数据

**模式 4：增量补缺**
- 检查 Emby 中已有的数据，只上传缺失的部分
- 避免重复上传，提高效率

### Hook 响应模式

**模式 0：关闭**
- 不响应 Hook 事件

**模式 1：只出本地**
- 演员更新时只导出到本地目录
- 使用覆盖模式（图片+NFO）

**模式 2：只上传 Emby**
- 演员更新时只上传到 Emby
- 使用覆盖模式（图片 + 元数据）

**模式 3：同时输出**
- 演员更新时同时导出本地和上传 Emby
- 都使用覆盖模式
- 新建演员使用异步上传（延迟 35 秒）

## 使用方法

### 自动同步
启用 `Performer.Update.Post` 钩子，在演员信息更新时自动同步。

### 手动同步
在 Tasks 页面运行 "同步所有演员" 任务，处理所有演员数据。

## 数据结构

本地导出的文件结构：
```
演员数据输出目录/
├── 演员姓名/
│   ├── folder.jpg (演员头像)
│   └── actor.nfo (演员详细信息)
```

NFO 文件包含以下信息：
- 姓名、性别、国家、出生/死亡日期
- 身高、三围、假胸、种族等身体特征
- 发色、眼色、纹身、穿孔等外貌描述
- 职业生涯、别名、个人网站链接
- Stash ID 等外部标识符

## Emby 元数据更新

插件通过 Emby API 直接更新以下元数据：
- 概述（包含所有演员信息）
- 生日和死亡日期
- 制作地点（国家）
- 标签（性别、国家、种族、身体特征等）
- 外部 ID（Stash ID）

## 故障排除

**无法连接到 Emby 服务器**
- 检查服务器地址和 API 密钥是否正确
- 确认网络连接正常
- 验证 Emby 服务器正在运行

**图片未上传到 Emby**
- 确认 Emby 上传模式已启用（不为 0）
- 检查 Stash 中演员是否有图片
- 验证 Emby API 密钥权限
- 确认演员名称在 Emby 中存在

**元数据未更新**
- 确认 Emby 上传模式包含元数据（模式 1 或 2）
- 检查 Emby 中是否存在同名演员
- 查看 Stash 日志获取详细错误信息

## 依赖

- Python 3.8+
- stashapi
- requests

## 版本

1.0.6
