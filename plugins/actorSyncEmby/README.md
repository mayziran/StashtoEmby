# 演员同步Emby插件 (Actor Sync Emby)

一个Stash插件，用于将演员信息（图片和元数据）从Stash同步到Emby服务器。

## 功能特性

- **演员图片同步** - 从Stash下载演员头像并上传到Emby
- **元数据导出** - 生成包含详细信息的NFO文件到本地目录
- **Emby集成** - 通过API直接更新Emby中的演员元数据
- **多种同步模式** - 支持覆盖、元数据更新和增量补齐三种模式
- **自动化钩子** - 支持在演员信息更新时自动同步
- **批量处理** - 支持一次性同步所有演员
- **模拟运行** - 提供dry-run模式预览操作

## 安装

1. 将 `actorSyncEmby` 文件夹复制到Stash的插件目录
2. 重启Stash服务
3. 在 设置 → 插件 中启用该插件

## 配置选项

| 配置项 | 类型 | 描述 |
|--------|------|------|
| `演员数据输出目录` | 字符串 | 本地存储演员图片和NFO文件的目录路径 |
| `导出演员NFO` | 布尔值 | 是否生成NFO文件（即使关闭也会通过API更新Emby元数据） |
| `下载演员图片` | 布尔值 | 是否下载演员图片（关闭后不会上传图片到Emby） |
| `同步到Emby` | 布尔值 | 是否将数据上传到Emby服务器 |
| `同步模式` | 数字 | 1=覆盖, 2=仅元数据, 3=补齐缺失数据 |
| `Emby服务器地址` | 字符串 | Emby服务器完整URL（如 http://192.168.1.100:8096） |
| `Emby API密钥` | 字符串 | Emby服务器API密钥 |
| `仅模拟` | 布尔值 | 模拟运行模式，不执行实际文件操作 |

## 同步模式说明

### 模式1：完全覆盖
- 无论Emby中是否已存在数据，都会重新上传图片和元数据
- 适用于需要完全同步的场景

### 模式2：元数据覆盖
- 仅更新元数据，不处理图片
- 保留Emby中现有的演员头像

### 模式3：增量补齐
- 检查Emby中已有的数据，只上传缺失的部分
- 避免重复上传，提高效率

## 使用方法

### 自动同步
启用 `Performer.Update.Post` 钩子，在演员信息更新时自动同步（使用模式1）。

### 手动同步
在 Tasks 页面运行 "同步所有演员" 任务，处理所有演员数据。

## 数据结构

本地导出的文件结构：
```
演员数据输出目录/
├── 演员姓名/
│   ├── folder.jpg (演员头像)
│   └── actor.nfo (演员详细信息)
```

NFO文件包含以下信息：
- 姓名、性别、国家、出生/死亡日期
- 身高、三围、假胸、种族等身体特征
- 发色、眼色、纹身、穿孔等外貌描述
- 职业生涯、别名、个人网站链接
- Stash ID等外部标识符

## Emby元数据更新

插件通过Emby API直接更新以下元数据：
- 概述（包含所有演员信息）
- 生日和死亡日期
- 制作地点（国家）
- 标签（性别、国家、种族、身体特征等）
- 外部ID（Stash ID）

## 故障排除

**无法连接到Emby服务器**
- 检查服务器地址和API密钥是否正确
- 确认网络连接正常
- 验证Emby服务器正在运行

**图片未上传到Emby**
- 确认"下载演员图片"选项已启用
- 检查Stash中演员是否有图片
- 验证Emby API密钥权限

**元数据未更新**
- 确认"同步到Emby"选项已启用
- 检查Emby中是否存在同名演员
- 查看Stash日志获取详细错误信息

## 依赖

- Python 3.8+
- stashapi
- requests

## 版本

1.0.0